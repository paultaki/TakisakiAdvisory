<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bee Colony – Pollen Quest</title>
    <!-- p5.js -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        background: #f5f8ff;
        font-family: Arial, Helvetica, sans-serif;
      }
      #ui {
        position: absolute;
        top: 12px;
        left: 12px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.9);
        padding: 12px 16px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        font-size: 14px;
      }
      #ui label {
        display: block;
        margin: 8px 0 2px;
        font-weight: bold;
      }
      #ui input[type="range"] {
        width: 160px;
      }
      #reset-btn {
        margin-top: 10px;
        padding: 6px 12px;
        border: none;
        background: #ffcc25;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
      }
      #reset-btn:hover {
        background: #ffda57;
      }
    </style>
  </head>
  <body>
    <div id="ui">
      <label for="beeCount">Bees: <span id="beeCountLabel"></span></label>
      <input type="range" id="beeCount" min="10" max="200" value="60" />

      <label for="flowerCount"
        >Flowers: <span id="flowerCountLabel"></span
      ></label>
      <input type="range" id="flowerCount" min="5" max="50" value="20" />

      <label for="beeSpeed">Bee speed: <span id="beeSpeedLabel"></span></label>
      <input type="range" id="beeSpeed" min="1" max="6" value="3" />

      <button id="reset-btn">Reset Simulation</button>
    </div>

    <script>
      // ---------- GLOBALS ---------- //
      let bees = [],
        flowers = [],
        hive;

      // DOM refs
      const beeSlider = document.getElementById("beeCount");
      const flowerSlider = document.getElementById("flowerCount");
      const speedSlider = document.getElementById("beeSpeed");
      const beeCountLabel = document.getElementById("beeCountLabel");
      const flowerCountLbl = document.getElementById("flowerCountLabel");
      const beeSpeedLabel = document.getElementById("beeSpeedLabel");
      const resetBtn = document.getElementById("reset-btn");

      // ---------- CLASSES ---------- //
      class Bee {
        constructor() {
          this.pos = createVector(random(width), random(height));
          this.speed = Number(speedSlider.value);
          this.carrying = 0; // pollen 0‑100
          this.target = this.chooseTarget();
        }
        chooseTarget() {
          if (this.carrying >= 100 || flowers.length === 0) return hive;
          return random(flowers);
        }
        update() {
          this.speed = Number(speedSlider.value);
          const dir = p5.Vector.sub(this.target.pos, this.pos);
          const dist = dir.mag();
          dir.setMag(this.speed);
          this.pos.add(dir);

          if (dist <= this.speed + 1) {
            if (this.target === hive) {
              this.carrying = 0; // deposit
            } else {
              const harvested = min(5, this.target.nectar);
              this.target.nectar -= harvested;
              this.carrying += harvested;
              if (this.target.nectar <= 0) this.target.respawn();
            }
            this.target = this.chooseTarget();
          }
        }
        draw() {
          push();
          translate(this.pos.x, this.pos.y);
          noStroke();
          fill("#ffcc25");
          ellipse(0, 0, 8, 8);
          fill("#000");
          rect(-2, -1, 4, 2);
          pop();
        }
      }

      class Flower {
        constructor(x, y) {
          this.pos = createVector(x, y);
          this.nectar = 100;
          this.respawnTimer = 0;
        }
        respawn() {
          this.nectar = 0;
          this.respawnTimer = 600;
        }
        update() {
          if (this.nectar <= 0 && this.respawnTimer > 0) {
            this.respawnTimer--;
            if (this.respawnTimer === 0) this.nectar = 100;
          }
        }
        draw() {
          push();
          translate(this.pos.x, this.pos.y);
          stroke(255, 204, 0);
          strokeWeight(2);
          fill(map(this.nectar, 0, 100, 200, 255), 80, 140);
          ellipse(0, 0, 12, 12);
          pop();
        }
      }

      class Hive {
        constructor(x, y) {
          this.pos = createVector(x, y);
        }
        draw() {
          push();
          translate(this.pos.x, this.pos.y);
          fill("#c58a3b");
          stroke("#8a5e23");
          strokeWeight(2);
          ellipse(0, 0, 40, 30);
          pop();
        }
      }

      // ---------- P5 SETUP ---------- //
      function setup() {
        createCanvas(windowWidth, windowHeight);
        initSimulation();
        updateLabels();
        resetBtn.addEventListener("click", initSimulation);
        beeSlider.oninput =
          flowerSlider.oninput =
          speedSlider.oninput =
            updateLabels;
      }

      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
        hive.pos.set(70, height / 2);
      }

      function draw() {
        background("#eaf2ff");
        flowers.forEach((f) => {
          f.update();
          f.draw();
        });
        bees.forEach((b) => {
          b.update();
          b.draw();
        });
        hive.draw();
        // HUD fact
        noStroke();
        fill(0, 180);
        textAlign(RIGHT, BOTTOM);
        textSize(12);
        text(
          "Fun fact: One bee can visit ~5,000 flowers a day, spreading pollen that helps plants grow fruit & seeds!",
          width - 12,
          height - 12
        );
      }

      // ---------- HELPERS ---------- //
      function initSimulation() {
        bees = [];
        flowers = [];
        hive = new Hive(70, height / 2);
        for (let i = 0; i < Number(flowerSlider.value); i++) {
          flowers.push(
            new Flower(random(150, width - 50), random(50, height - 50))
          );
        }
        for (let i = 0; i < Number(beeSlider.value); i++) {
          bees.push(new Bee());
        }
      }

      function updateLabels() {
        beeCountLabel.textContent = beeSlider.value;
        flowerCountLbl.textContent = flowerSlider.value;
        beeSpeedLabel.textContent = speedSlider.value;
      }
    </script>
  </body>
</html>
